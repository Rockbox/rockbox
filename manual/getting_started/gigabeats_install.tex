% $Id$

\warn{Before starting this procedure, ensure that you have a copy
of the original \playerman{} firmware. Without this, it is
\emph{not} possible to uninstall Rockbox. The \playerman{}
firmware can be downloaded from
\url{http://www.tacp.toshiba.com/tacpassets-images/firmware/MESV12US.zip}.\\}

Installing the bootloader is only needed once. It involves replacing the
existing firmware file on your \dap{} with another version.
When running the original \playerman{} firmware (a version of Windows CE), it is
only possible to connect the \dap{} to a PC in ``MTP mode'', which hides
the actual content of your \daps{} disk and provides restricted access
to its contents.
In reality, the \daps{} hard disk contains two partitions, a small
(150MB) ``firmware partition'' containing the \daps{} firmware (operating
system), and a second ``data partition'' containing your media files. The main
firmware file in the bootloader partition is called \fname{nk.bin}, and
this is the file that is loaded into RAM (by the \daps{} ROM-based
bootloader) and executed when your \dap{} is powered on.

\subsubsection{Bootloader installation from Windows}

\begin{enumerate}

\item Attach your \dap{} to your computer.

\item Download \fname{beastpatcher.exe} from
\fixme{add download location}
and run it.

\item You should see some information displayed about
your \dap{} and a message asking you if you wish to install the Rockbox
bootloader. Press i followed by ENTER, and beastpatcher will
install the bootloader. After a short time you should see the message
``[INFO] Bootloader installed successfully'' followed by some error
messages that you can safely ignore. Press ENTER again to exit
beastpatcher.

\item After a successful installation, your \dap{} will immediately turn off.
Turn it on again, and (because it is still connected to your PC)
it will enter the Rockbox bootloader's
``USB Mass Storage'' mode, which exposes your \daps{} disk to your computer
as a standard USB Mass Storage device.
\end{enumerate}

\subsubsection{Bootloader installation from Mac OS X}
\begin{enumerate}
\item Attach your \dap{} to your computer.

\item Download and open beastpatcher.dmg from 
\fixme{add download location}
and then double-click on the beastpatcher icon inside. You can also
drag the beastpatcher icon to a location on your hard drive and launch
it from the Terminal.

\item If all has gone well, you should see some 
information displayed about your \dap{} and a message asking you if you 
wish to install the Rockbox bootloader. Press i followed by ENTER, and 
beastpatcher will now install the bootloader. After a short time you 
should see the message ``[INFO] Bootloader installed successfully''
followed by some error messages that you can safely ignore. Press 
ENTER again to exit beastpatcher and then quit the Terminal application.

\item After a successful installation, your \dap{} will immediately turn off.
Turn it on again, and (because it is still connected to your Mac)
it will enter the Rockbox bootloader's
``USB Mass Storage'' mode, which exposes your \daps{} disk to your computer
as a standard USB Mass Storage device.
\end{enumerate}

\subsubsection{Bootloader installation from Linux}

\begin{enumerate}

\item Download beastpatcher from
\fixme{add download location} (32-bit x86 
binary) or \fixme{add download location} 
(64-bit amd64 binary). You can save this anywhere you wish, but the next 
steps will assume you have saved it in your home directory.

\item Attach your \dap{} to your computer.

\item Open up a terminal window and type the following commands:

\begin{code} 
    cd $HOME
    chmod +x beastpatcher
    ./beastpatcher
\end{code}

\item If all has gone well, you should see some information displayed about
your \dap{} and a message asking you if you wish to install the Rockbox
bootloader. Press i followed by ENTER, and beastpatcher will now install the
bootloader. After a short time you should see the message ``[INFO] Bootloader
installed successfully'' followed by some error
messages that you can safely ignore. Press ENTER again to exit beastpatcher.

\item After a successful installation, your \dap{} will immediately turn off.
Turn it on again, and (because it is still connected to your PC)
it will enter the Rockbox bootloader's
``USB Mass Storage'' mode, which exposes your \daps{} disk to your computer
as a standard USB Mass Storage device.

\end{enumerate}